@page
@model FitTrackPro.Pages.Recipes.DetailsModel
@{
    ViewData["Title"] = Model.recipe.recipeName;
}

<div class="container mt-4">
    <div class="row">
        <div class="col-md-12 mb-3">
            <a asp-page="./Index" class="btn btn-secondary">Back to Recipes</a>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h2 class="mb-0">@Model.recipe.recipeName</h2>
                </div>
                <div class="card-body">
                    <div class="mb-4">
                        <span class="badge bg-@(Model.recipe.category.ToString().ToLower() == "breakfast" ? "success" :
                                                 Model.recipe.category.ToString().ToLower() == "lunch" ? "info" :
                                                 Model.recipe.category.ToString().ToLower() == "dinner" ? "warning" : "secondary") me-2">
                            @Model.recipe.category
                        </span>
                        @if (Model.recipe.isCustom)
                        {
                            <span class="badge bg-primary">Custom Recipe</span>
                        }
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <p><strong>Prep Time:</strong> @Model.recipe.prepTimeDisplay</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Servings:</strong> @Model.recipe.servings</p>
                        </div>
                    </div>

                    <h4 class="mb-3">Ingredients</h4>
                    <ul class="list-group mb-4">
                        @foreach (var ingredient in Model.recipe.ingredients.OrderBy(i => i.category))
                        {
                            <li class="list-group-item">
                                @ingredient.displayText
                                <small class="text-muted">(@ingredient.category)</small>
                            </li>
                        }
                    </ul>

                    <h4 class="mb-3">Instructions</h4>
                    <div class="card bg-light">
                        <div class="card-body">
                            <p class="mb-0" style="white-space: pre-line;">@Model.recipe.instructions</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">Nutrition Information</h5>
                    <small>Per Serving</small>
                </div>
                <div class="card-body">
                    <table class="table table-sm mb-0">
                        <tbody>
                            <tr>
                                <td><strong>Calories</strong></td>
                                <td class="text-end">@Model.recipe.caloriesPerServing kcal</td>
                            </tr>
                            <tr>
                                <td><strong>Protein</strong></td>
                                <td class="text-end">@Model.recipe.proteinGrams g</td>
                            </tr>
                            <tr>
                                <td><strong>Carbohydrates</strong></td>
                                <td class="text-end">@Model.recipe.carbsGrams g</td>
                            </tr>
                            <tr>
                                <td><strong>Fats</strong></td>
                                <td class="text-end">@Model.recipe.fatsGrams g</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card mb-3">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">Macro Distribution</h5>
                </div>
                <div class="card-body">
                    <div class="mb-2">
                        <div class="d-flex justify-content-between">
                            <span>Protein</span>
                            <span>@Model.macroPercentages.GetValueOrDefault("protein", 0)%</span>
                        </div>
                        <div class="progress" style="height: 20px;">
                            <div class="progress-bar bg-danger" role="progressbar"
                                 style="width: @Model.macroPercentages.GetValueOrDefault("protein", 0)%">
                            </div>
                        </div>
                    </div>

                    <div class="mb-2">
                        <div class="d-flex justify-content-between">
                            <span>Carbs</span>
                            <span>@Model.macroPercentages.GetValueOrDefault("carbs", 0)%</span>
                        </div>
                        <div class="progress" style="height: 20px;">
                            <div class="progress-bar bg-warning" role="progressbar"
                                 style="width: @Model.macroPercentages.GetValueOrDefault("carbs", 0)%">
                            </div>
                        </div>
                    </div>

                    <div class="mb-0">
                        <div class="d-flex justify-content-between">
                            <span>Fats</span>
                            <span>@Model.macroPercentages.GetValueOrDefault("fats", 0)%</span>
                        </div>
                        <div class="progress" style="height: 20px;">
                            <div class="progress-bar bg-success" role="progressbar"
                                 style="width: @Model.macroPercentages.GetValueOrDefault("fats", 0)%">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header bg-warning text-white">
                    <h5 class="mb-0">Total Nutrition</h5>
                    <small>For All @Model.recipe.servings Servings</small>
                </div>
                <div class="card-body">
                    <p class="mb-1"><strong>Total Calories:</strong> @Model.recipe.totalCalories kcal</p>
                    <p class="mb-1"><strong>Total Protein:</strong> @(Model.recipe.proteinGrams * Model.recipe.servings) g</p>
                    <p class="mb-1"><strong>Total Carbs:</strong> @(Model.recipe.carbsGrams * Model.recipe.servings) g</p>
                    <p class="mb-0"><strong>Total Fats:</strong> @(Model.recipe.fatsGrams * Model.recipe.servings) g</p>
                </div>
            </div>
        </div>
    </div>
</div>
